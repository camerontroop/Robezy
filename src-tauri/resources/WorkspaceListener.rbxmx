<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<Meta name="ExplicitAutoJoints">true</Meta>
	<External>null</External>
	<External>nil</External>
	<Item class="Script" referent="RBX0">
		<Properties>
			<Content name="LinkedSource"><null></null></Content>
			<int64 name="SourceAssetId">-1</int64>
			<BinaryString name="Tags"></BinaryString>
			<string name="Name">WorkspaceListener</string>
			<string name="ScriptGuid">{B2C3D4E5-F6G7-8901-2345-67890ABCDEF0}</string>
			<ProtectedString name="Source"><![CDATA[local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")

local COMPANION_URL = "http://localhost:3030/workspace"
local DEBOUNCE_TIME = 1.0
local lastUpdate = 0
local updatePending = false

local function serializeInstance(inst)
    local children = {}
    for _, child in ipairs(inst:GetChildren()) do
        table.insert(children, serializeInstance(child))
    end
    
    return {
        Name = inst.Name,
        ClassName = inst.ClassName,
        Children = children
    }
end

local function sendSnapshot()
    if os.clock() - lastUpdate < DEBOUNCE_TIME then
        if not updatePending then
            updatePending = true
            task.delay(DEBOUNCE_TIME, sendSnapshot)
        end
        return
    end

    lastUpdate = os.clock()
    updatePending = false

    local snapshot = serializeInstance(Workspace)
    local payload = {
        type = "snapshot",
        tree = snapshot,
        timestamp = os.time()
    }

    pcall(function()
        HttpService:PostAsync(
            COMPANION_URL, 
            HttpService:JSONEncode(payload),
            Enum.HttpContentType.ApplicationJson,
            false
        )
    end)
    print("Connector: Workspace Snapshot Sent")
end

-- Initial Snapshot
task.defer(sendSnapshot)

-- Listen for changes (Debounced)
Workspace.DescendantAdded:Connect(sendSnapshot)
Workspace.DescendantRemoving:Connect(sendSnapshot)

print("WorkspaceListener Active")
]]></ProtectedString>
		</Properties>
	</Item>
</roblox>
